<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Merry Christmas ♡  </title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600&family=Playfair+Display:ital,wght@1,600&display=swap" rel="stylesheet">
    
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #050505; touch-action: none; font-family: 'Montserrat', sans-serif; }
        
        .bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1a2a6c, #000);
            z-index: -1;
        }

        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 2000;
            display: flex; flex-direction: column; justify-content: center; align-items: center; color: white;
            transition: opacity 1s;
        }
        
        button {
            padding: 15px 40px; border-radius: 50px; border: none; 
            background: linear-gradient(45deg, #a8c0ff, #3f2b96); 
            color: white; font-weight: bold; font-size: 1.2rem; cursor: pointer; margin-top: 30px;
            box-shadow: 0 0 20px rgba(168, 192, 255, 0.4);
        }

     
        #globe-wrapper {
            position: relative;
            width: 320px; height: 320px;
            margin: auto; top: 50%; transform: translateY(-60%); 
            border-radius: 50%;
            box-shadow: 0 0 50px rgba(100, 200, 255, 0.1);
        }

    
        #physics-canvas {
            position: absolute; top: 0; left: 0;
            border-radius: 50%;
            z-index: 1;
            background: rgba(255,255,255,0.05);
        }

       
        #scratch-canvas {
            position: absolute; top: 0; left: 0;
            border-radius: 50%;
            z-index: 10; 
            cursor: grab;
            touch-action: none;
        }

      
        .glass-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            border-radius: 50%;
            border: 4px solid rgba(255,255,255,0.1);
            box-shadow: inset 0 0 30px rgba(255,255,255,0.2);
            pointer-events: none; 
            z-index: 20;
        }

       
        .base {
            position: absolute; bottom: -50px; left: 50%; transform: translateX(-50%);
            width: 240px; height: 60px; background: linear-gradient(to bottom, #333, #111);
            border-radius: 0 0 40px 40px; z-index: 0;
            box-shadow: 0 10px 30px black; border-top: 4px solid #555;
        }

        
        .message-area {
            position: absolute; bottom: 5%; width: 100%; text-align: center; color: #a8c0ff;
            pointer-events: none; transition: opacity 0.5s;
        }
        h2 { font-family: 'Playfair Display', serif; font-weight: normal; margin-bottom: 5px; }
        p { font-size: 0.9rem; opacity: 0.8; }

        .hidden { opacity: 0; pointer-events: none; }
    </style>
</head>
<body>

    <div class="bg"></div>

    <div id="overlay">
        <h1>❄️</h1>
        <p>Aumente o som</p>
        <button id="start-btn">Começar</button>
    </div>

    <div id="globe-wrapper">
        <canvas id="physics-canvas" width="320" height="320"></canvas>
        <canvas id="scratch-canvas" width="320" height="320"></canvas>
        <div class="glass-overlay"></div>
        <div class="base"></div>
    </div>

    <div class="message-area" id="msg-box">
        <h2 id="main-text">Está muito frio...</h2>
        <p id="sub-text">Passe o dedo no vidro para limpar e ver o que tem dentro...</p>
    </div>

    <audio id="music" loop>
        <source src="musga.mp3" type="audio/mpeg">
    </audio>

    <script>
        
        const photoList = [ '1.jpg', '2.jpeg', '3.jpeg']; 
      

        const startBtn = document.getElementById('start-btn');
        const overlay = document.getElementById('overlay');
        const music = document.getElementById('music');
        const scratchCanvas = document.getElementById('scratch-canvas');
        const physicsCanvas = document.getElementById('physics-canvas');
        const ctxScratch = scratchCanvas.getContext('2d');
        const msgBox = document.getElementById('msg-box');
        const mainText = document.getElementById('main-text');
        const subText = document.getElementById('sub-text');

        let isRevealed = false;

        
        function initScratch() {
            
            ctxScratch.fillStyle = "rgba(200, 225, 255, 0.85)"; 
            ctxScratch.fillRect(0, 0, 320, 320);
            
           
            for(let i=0; i<100; i++) {
                ctxScratch.fillStyle = "rgba(255,255,255,0.4)";
                ctxScratch.beginPath();
                ctxScratch.arc(Math.random()*320, Math.random()*320, Math.random()*2, 0, Math.PI*2);
                ctxScratch.fill();
            }

            
            ctxScratch.globalCompositeOperation = 'destination-out';
        }

        function scratch(x, y) {
            if(isRevealed) return;

            ctxScratch.beginPath();
            ctxScratch.arc(x, y, 25, 0, Math.PI * 2); 
            ctxScratch.fill();
            
            checkProgress();
        }

      
        function getPos(canvas, evt) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: (evt.clientX || evt.touches[0].clientX) - rect.left,
                y: (evt.clientY || evt.touches[0].clientY) - rect.top
            };
        }

        ['mousemove', 'touchmove'].forEach(evtType => {
            scratchCanvas.addEventListener(evtType, (e) => {
               
                if (evtType === 'mousemove' && e.buttons !== 1) return;
                e.preventDefault(); 
                const pos = getPos(scratchCanvas, e);
                scratch(pos.x, pos.y);
            });
        });

       
        let checkThrottle = 0;
        function checkProgress() {
            checkThrottle++;
            if(checkThrottle % 10 !== 0) return; 

          
            const imgData = ctxScratch.getImageData(0, 0, 320, 320);
            const pixels = imgData.data;
            let transparent = 0;
            
       
            for (let i = 3; i < pixels.length; i += 8) { 
                if (pixels[i] < 128) transparent++;
            }

            const total = pixels.length / 8;
            const percent = (transparent / total) * 100;

            if (percent > 50 && !isRevealed) {
                revealAll();
            }
        }

        function revealAll() {
            isRevealed = true;
            scratchCanvas.style.transition = "opacity 2s";
            scratchCanvas.style.opacity = "0"; 
            
          
            msgBox.style.opacity = 0;
            setTimeout(() => {
                mainText.innerText = "Agora você vê tudo com clareza...";
                subText.innerText = "Nossas memórias são meu lugar favorito... Feliz Natal Ju <3";
                msgBox.style.opacity = 1;
            }, 1000);
        }


      
        function initPhysics() {
            var Engine = Matter.Engine, Render = Matter.Render, Runner = Matter.Runner,
                Bodies = Matter.Bodies, Composite = Matter.Composite, Mouse = Matter.Mouse,
                MouseConstraint = Matter.MouseConstraint;

            var engine = Engine.create();
            var world = engine.world;

            var render = Render.create({
                canvas: physicsCanvas,
                engine: engine,
                options: { width: 320, height: 320, background: 'transparent', wireframes: false }
            });

          
            const thick = 100;
            const w = 320, h = 320;
            Composite.add(world, [
                Bodies.rectangle(w/2, h+thick/2, w, thick, { isStatic: true, render:{opacity:0} }),
                Bodies.rectangle(w/2, -thick/2, w, thick, { isStatic: true, render:{opacity:0} }),
                Bodies.rectangle(-thick/2, h/2, thick, h, { isStatic: true, render:{opacity:0} }),
                Bodies.rectangle(w+thick/2, h/2, thick, h, { isStatic: true, render:{opacity:0} })
            ]);

          
            photoList.forEach(imgSrc => {
                let body = Bodies.rectangle(Math.random()*200+60, Math.random()*200, 70, 70, { 
                    restitution: 0.5,
                    render: {
                        sprite: { texture: imgSrc, xScale: 0.15, yScale: 0.15 }
                    }
                });
                Composite.add(world, body);
            });

    
            for(let i=0; i<80; i++){
                let snow = Bodies.circle(Math.random()*w, Math.random()*h, 2, {
                    frictionAir: 0.02, density: 0.01,
                    render: { fillStyle: 'white' }
                });
                Composite.add(world, snow);
            }

            
            window.addEventListener('deviceorientation', (e) => {
                let x = (e.gamma || 0) / 20; let y = (e.beta || 0) / 20;
                engine.world.gravity.x = Math.min(Math.max(x, -1), 1);
                engine.world.gravity.y = Math.min(Math.max(y, -1), 1);
            });
            
            let lastShake = 0;
            window.addEventListener('devicemotion', (e) => {
                let acc = e.acceleration;
                if(!acc) return;
                let force = Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z);
                if(force > 20 && Date.now() - lastShake > 500) {
                    lastShake = Date.now();
                    Composite.allBodies(world).forEach(b => {
                        if(!b.isStatic) Matter.Body.applyForce(b, b.position, {x: (Math.random()-0.5)*0.02, y: -0.02});
                    });
                }
            });

            Runner.run(Runner.create(), engine);
            Render.run(render);
        }

        
        startBtn.addEventListener('click', () => {
            music.volume = 0.5;
            music.play().catch(()=>{});
            
           
            if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission().then(r => { if(r==='granted') initPhysics(); });
            } else {
                initPhysics();
            }

            initScratch(); 
            overlay.style.opacity = 0;
            setTimeout(() => { overlay.style.display = 'none'; }, 1000);
        });

    </script>
</body>
</html>