<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para Você</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400&display=swap" rel="stylesheet">
    
    <style>
        body, html {
            margin: 0; padding: 0; height: 100%; overflow: hidden;
            font-family: 'Poppins', sans-serif;
            background: radial-gradient(circle at 50% 30%, #1a0b2e, #000000); /* Roxo bem escuro e preto */
            display: flex; justify-content: center; align-items: center;
            touch-action: none;
        }

        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 2000; color: #fff; text-align: center; transition: opacity 0.8s;
        }
        #start-btn {
            margin-top: 20px; padding: 15px 40px;
            background: #e0c3fc; color: #240046; border: none; border-radius: 50px;
            font-weight: bold; font-size: 1.1rem; cursor: pointer;
            box-shadow: 0 0 15px rgba(224, 195, 252, 0.4);
        }

        .globe-container {
            position: relative; width: 320px; height: 420px;
            display: flex; flex-direction: column; align-items: center;
            opacity: 0; transition: opacity 1.5s;
        }
        
        .glass-sphere {
            position: relative; width: 320px; height: 320px; border-radius: 50%;
            /* Vidro mais realista */
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.01) 50%, transparent 80%);
            box-shadow: inset 0 0 20px rgba(255,255,255,0.2), 0 0 25px rgba(100,100,255,0.1);
            border: 1px solid rgba(255,255,255,0.15);
            overflow: hidden; z-index: 10;
        }

        .photo-carousel {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;
            display: flex; justify-content: center; align-items: center; pointer-events: none;
        }
        .photo-carousel img {
            position: absolute; width: 110%; height: 110%; object-fit: cover;
            opacity: 0; transition: opacity 1.5s ease-in-out; filter: brightness(0.75);
        }
        .photo-carousel img.active { opacity: 1; }

        #snow-canvas { position: absolute; top: 0; left: 0; z-index: 5; }

        .base-structure { margin-top: -25px; z-index: 5; display: flex; flex-direction: column; align-items: center; }
        .gold-ring { width: 260px; height: 20px; background: linear-gradient(90deg, #b8860b, #ffd700, #b8860b); border-radius: 50%; z-index: 6; }
        .wood-pedestal {
            width: 240px; height: 60px; background: linear-gradient(180deg, #3e2311, #1a0f00);
            border-radius: 0 0 40px 40px; margin-top: -10px; z-index: 5;
            box-shadow: 0 15px 30px rgba(0,0,0,0.8);
        }

        .caption-container { position: absolute; bottom: -80px; width: 100%; text-align: center; color: #e0c3fc; }
        .caption-container h3 { font-family: 'Playfair Display', serif; font-size: 1.3rem; text-shadow: 0 2px 4px #000; margin: 0; padding: 0 10px;}
    </style>
</head>
<body>

    <div id="overlay">
        <h1>✨</h1>
        <p>Aumente o som.</p>
        <p style="font-size: 0.8rem; opacity: 0.7;">(Mexa o celular ou toque na neve)</p>
        <button id="start-btn">VER PRESENTE</button>
    </div>

    <audio id="bg-music" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <div class="globe-container" id="main-container">
        <div class="glass-sphere">
            <canvas id="snow-canvas"></canvas>
            <div class="photo-carousel">
                <img src="1.jpg" class="active">
                <img src="2.jpeg">
                <img src="3.jpeg">
            </div>
        </div>
        <div class="base-structure">
            <div class="gold-ring"></div>
            <div class="wood-pedestal"></div>
        </div>
        <div class="caption-container">
            <h3 id="caption-text">...</h3>
        </div>
    </div>

    <script>
        const startBtn = document.getElementById('start-btn');
        const overlay = document.getElementById('overlay');
        const mainContainer = document.getElementById('main-container');
        const music = document.getElementById('bg-music');
        const captionText = document.getElementById('caption-text');
        
        let engine, render, world, runner;

        function initPhysics() {
            const canvas = document.getElementById('snow-canvas');
            const width = 320;
            const height = 320;

            var Engine = Matter.Engine, Render = Matter.Render, World = Matter.World, 
                Bodies = Matter.Bodies, Runner = Matter.Runner, Mouse = Matter.Mouse, 
                MouseConstraint = Matter.MouseConstraint;

            engine = Engine.create();
            world = engine.world;

            // Renderização Transparente
            render = Render.create({
                canvas: canvas, engine: engine,
                options: { width: width, height: height, background: 'transparent', wireframes: false }
            });

            // Paredes Invisíveis (Grossas para nada escapar)
            const thick = 200; // Paredes de 200px de espessura
            World.add(world, [
                Bodies.rectangle(width/2, height + thick/2, width+thick*2, thick, { isStatic: true, render: {opacity: 0} }),
                Bodies.rectangle(width/2, -thick/2, width+thick*2, thick, { isStatic: true, render: {opacity: 0} }),
                Bodies.rectangle(-thick/2, height/2, thick, height+thick*2, { isStatic: true, render: {opacity: 0} }),
                Bodies.rectangle(width + thick/2, height/2, thick, height+thick*2, { isStatic: true, render: {opacity: 0} })
            ]);

            // Criar Neve "Suave"
            for (let i = 0; i < 110; i++) {
                let x = Math.random() * width;
                let y = Math.random() * height;
                let size = Math.random() * 3 + 2; // Tamanho
                
                let flake = Bodies.circle(x, y, size, {
                    friction: 0.001, 
                    restitution: 0.5, // Menos quique (antes era 0.8)
                    density: 0.005,   // Um pouco mais pesada
                    frictionAir: 0.04, // IMPORTANTE: Resistencia do ar (simula água)
                    label: 'snow',
                    render: { fillStyle: '#ffffff' }
                });
                World.add(world, flake);
            }

            // Controle pelo Mouse/Dedo
            let mouse = Mouse.create(render.canvas);
            let mouseConstraint = MouseConstraint.create(engine, {
                mouse: mouse,
                constraint: { stiffness: 0.1, render: { visible: false } }
            });
            World.add(world, mouseConstraint);
            render.mouse = mouse; 

            // Rodar
            runner = Runner.create();
            Runner.run(runner, engine);
            Render.run(render);
        }

        // --- Sensores ---
        
        // Inclinação Suave
        function handleTilt(e) {
            if(!engine) return;
            let x = (e.gamma || 0) / 40; 
            let y = (e.beta || 0) / 40;
            // Limita a gravidade
            engine.world.gravity.x = Math.min(Math.max(x, -1), 1);
            engine.world.gravity.y = Math.min(Math.max(y, -1), 1);
        }

        // Sacudida Controlada
        let lastShake = 0;
        function handleShake(e) {
            if(!engine) return;
            let acc = e.accelerationIncludingGravity;
            if(!acc) return;
            
            // Verifica a força total
            let force = Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z);
            let now = Date.now();

            // Só ativa se for forte E se já passou um tempinho da última (evita spam)
            if (force > 25 && now - lastShake > 500) { 
                lastShake = now;
                let bodies = Matter.Composite.allBodies(engine.world);
                bodies.forEach(b => {
                    if(b.label === 'snow') {
                        // Força controlada
                        Matter.Body.applyForce(b, b.position, {
                            x: (Math.random() - 0.5) * 0.002, // Força MUITO menor que antes
                            y: -0.002 // Empurra levemente pra cima
                        });
                    }
                });
            }
        }

        // --- Iniciar ---
        function startApp() {
            music.volume = 0.5;
            music.play().catch(()=>{});
            
            initPhysics();
            
            // Pedir permissão iOS
            if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission()
                    .then(state => {
                        if (state === 'granted') {
                            window.addEventListener('deviceorientation', handleTilt);
                            window.addEventListener('devicemotion', handleShake);
                        }
                    }).catch(e => console.error(e));
            } else {
                window.addEventListener('deviceorientation', handleTilt);
                window.addEventListener('devicemotion', handleShake);
            }

            overlay.style.opacity = 0;
            setTimeout(() => { overlay.style.display = 'none'; mainContainer.style.opacity = 1; }, 800);
            startCarousel();
        }

        startBtn.addEventListener('click', startApp);

        // --- Legendas ---
        const images = document.querySelectorAll('.photo-carousel img');
        
        // SEUS TEXTOS AQUI
        const captions = [
            "Desde 2018...", 
            "Momentos inesquecíveis", 
            "Player 1 & Player 2", 
            "Feliz Natal! Você é especial pra mim."
        ];
        
        let idx = 0;
        function startCarousel() {
            if(captions[0]) captionText.innerText = captions[0];
            setInterval(() => {
                images[idx].classList.remove('active');
                idx = (idx + 1) % images.length;
                images[idx].classList.add('active');
                if(captions[idx]) captionText.innerText = captions[idx];
            }, 5000);
        }
    </script>
</body>
</html>